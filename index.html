<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>My Harmonic Collection</title>
    <link rel="stylesheet" href="styles.css">
</head>

<body>
    <!-- Persistent audio player (kept outside the dynamic content). Autoplay/loop; playsinline for mobile. -->
    <audio id="bg-audio" autoplay loop playsinline preload="auto">
        <source src="/images/The Beast OST Suite.mp3" type="audio/mpeg">
        Your browser does not support the audio element.
    </audio>

    <!-- Content area that will be swapped via PJAX so audio isn't interrupted -->
    <main id="content">
        <div id="pjax-content">
            <h1>Fateful Expansion of Ai!</h1>
            <p>Explore the collection below.</p>
            <img src="images/AdobeStock_565971196.png" width="600" height="450" alt="">
        </div>
    </main>

    <script>
        // Simple PJAX: intercept same-origin link clicks, fetch the page, extract #pjax-content, replace content
        (function () {
            const audio = document.getElementById('bg-audio');
            const content = document.getElementById('content');

                            // Attempt autoplay; remove visual controls. If browser blocks autoplay with sound,
                            // play will be attempted again on the first user gesture (click/touch) without showing a button.
                            function tryPlayOnce() {
                                if (!audio) return;
                                audio.play().catch(()=>{});
                                document.removeEventListener('click', tryPlayOnce);
                                document.removeEventListener('touchstart', tryPlayOnce);
                            }
                            // Try immediately, then listen for a gesture fallback
                            tryPlayOnce();
                            document.addEventListener('click', tryPlayOnce);
                            document.addEventListener('touchstart', tryPlayOnce, {passive: true});

            // Helper to fetch and replace content
            async function loadUrl(url, addToHistory = true) {
                try {
                    const res = await fetch(url, {cache: 'no-store'});
                    if (!res.ok) throw new Error('Network response was not ok');
                    const text = await res.text();
                    const parser = new DOMParser();
                    const doc = parser.parseFromString(text, 'text/html');

                    // Try to find the pjax content in the returned doc
                    const newContent = doc.querySelector('#pjax-content') || doc.querySelector('main') || doc.body;
                    const newTitle = doc.querySelector('title');

                    if (newContent) {
                        // Replace inner content of the #content element
                        const wrapper = document.createElement('div');
                        wrapper.innerHTML = newContent.innerHTML;
                        // optional: simple fade
                        content.style.opacity = 0;
                        setTimeout(() => {
                            content.innerHTML = wrapper.innerHTML;
                            content.style.opacity = 1;
                        }, 160);
                    }

                    if (newTitle) document.title = newTitle.textContent;

                    if (addToHistory) history.pushState({url: url}, '', url);
                } catch (err) {
                    console.error('PJAX load failed for', url, err);
                    // fallback to full navigation
                    window.location.href = url;
                }
            }

            // Intercept clicks on internal links
            document.addEventListener('click', function (e) {
                const a = e.target.closest('a');
                if (!a) return;
                const href = a.getAttribute('href');
                if (!href) return;
                // Only handle same-origin and relative links
                if (href.startsWith('http') && new URL(href, location.href).origin !== location.origin) return;
                // Allow hash and external anchors to behave normally
                if (href.startsWith('#') || a.target === '_blank' || a.hasAttribute('download')) return;

                // Prevent default navigation and load via PJAX
                e.preventDefault();
                const url = new URL(href, location.href).href;
                if (url === location.href) return; // same URL
                loadUrl(url);
            });

            // Handle back/forward
            window.addEventListener('popstate', function (e) {
                const url = location.href;
                loadUrl(url, false);
            });

            // no visual audio controls â€” nothing to initialize
        })();
    </script>

</body>
</html>
